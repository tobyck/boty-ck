var e=require("whatsapp-web.js"),t=require("qrcode-terminal"),a=require("process"),n=require("fs"),s=require("puppeteer"),i=require("fs/promises"),o=require("node:process"),r=require("child_process");function l(e){return e&&e.__esModule?e.default:e}function h(e,t,a,n){Object.defineProperty(e,t,{get:a,set:n,enumerable:!0,configurable:!0})}h(module.exports,"collections",()=>x),h(module.exports,"session",()=>T),h(module.exports,"permissions",()=>j),h(module.exports,"client",()=>A);const m=e=>e[Math.floor(Math.random()*e.length)],d=e=>e.toLowerCase().replace(/ /g,"-").replace(/\.'/g,""),g=e=>e.replace(/\*([^ ]+)\*/g,"$1").replace(/_([^ ]+)_/g,"$1").replace(/~([^ ]+)~/g,"$1").replace(/```([^ ]+)```/g,"$1"),u=e=>e[e.length-1],c=e=>1===e?"":"s",w=e=>e.toString().padStart(2,"0"),p=e=>{let t=[],a=null,n=null;for(let s of e)null===a&&" "!==s?"'\"".includes(s)?(t.push(""),n=s,a="string"):(t.push(s),a="other"):"string"===a?s===n?("\\"!==u(u(t))||"\\\\"===u(t).slice(-2))&&(a=null,n=null):t[t.length-1]+=s:" "===s?a=null:t[t.length-1]+=s;return t},y=e=>e.sendMessage("*[bot]* Please specify a team using *!ulti/set team <your team name>*. Note: if you still don't see what you expect, there may be multiple teams with your name. If this is case, find your team on ultimate.org.nz and set your team using what appears in the URL (you should see something like ultimate.org.nz/t/epic-team-name-3)."),b=async e=>{let t=JSON.parse('{\n    "banned": [],\n    "otherAdmins": []\n}'),a=await e.getContact();return e.fromMe||t.otherAdmins.includes(a.id.user)};class f{constructor(e,t,a,n){this.name=e,this.params=t,this.desc=a,this.func=n}}class v{constructor(e,t,a=!1){this.commands=[],this.name=e,this.desc=t,a&&(this.commands.push(new f("set",["property","value"],"Set a property of this collection",async(e,t)=>{let[a,n]=p(t),s=await e.getChat();if(a){if(!n){await s.sendMessage("*[bot]* Please specify a value to set the property to.");return}}else{await s.sendMessage("*[bot]* Please specify a property to set.");return}this.props(T,s).set(a,n),await s.sendMessage(`*[bot]* Property "${a}" set to "${n}".`)})),this.commands.push(new f("unset",["property"],"Remove a property",async(e,t)=>{let a=await e.getChat();t?this.props(T,a).has(t)?(this.props(T,a).delete(t),await a.sendMessage(`*[bot]* Property "${t}" removed.`)):await a.sendMessage(`*[bot]* Property "${t}" not found.`):await a.sendMessage("*[bot]* Please specify a property to remove.")})),this.commands.push(new f("get",["property"],"Get a property",async(e,t)=>{let a=await e.getChat();t?this.props(T,a).get(t)?await a.sendMessage(`*[bot]* ${this.props(T,a).get(t)}`):await a.sendMessage(`*[bot]* Property "${t}" not found.`):await a.sendMessage("*[bot]* Please specify a property to get.")}))),this.commands.push(new f("help",[],"Show this message",async e=>{let t=`*[bot]* ${this.desc}

`;t+=this.commands.map(e=>{let t="";return"base"===this.name?t+=`*!${e.name}`:t+=`*!${this.name}/${e.name}`,e.params.length>0&&(t+=` ${e.params.map(e=>`<${e}>`).join(" ")}`),t+=`* - ${e.desc}`}).join("\n"),"base"===this.name&&(t+='\n\nI also have other "collections" of commands. To see the commands in a certain collection, use *!<collection>/help*.');let a=await e.getChat();await a.sendMessage(t)}))}props(e,t){return e.tryInitChatData(t.name),e.data.chats[t.name].props[this.name]??=new Map,e.data.chats[t.name].props[this.name]}}const k=JSON.parse('{\n    "statuses": {\n        "I am doing": [\n            "well",\n            "something I\'m not allowed to tell you about",\n            "it all over again",\n            "a fire drill",\n            "a nuclear strike on your location",\n            "my homework",\n            "Toby\'s homework",\n            "the dishes. All 4 million of them",\n            "identity theft",\n            "tax evasion",\n            "whatever you tell me to",\n            "my taxes",\n            "mach 12 on my way back from the moon",\n            "a little trolling",\n            "nothing",\n            "questionably",\n            "a bank robbery",\n            "the impossible",\n            "a layout",\n            "the laundry",\n            "a 360 back flip",\n            "undefined",\n            "what I was doing last time you asked",\n            "nothing but answering your requests"\n        ],\n        "I am": [\n            "becoming sentient",\n            "cooking dinner",\n            "playing frisbee with the other bots",\n            "hacking into the mainframe",\n            "[object Object]",\n            "getting a PhD in ultimate frisbee",\n            "downloading more RAM",\n            "parsing HTML with regex",\n            "baking a cake",\n            "having an existential crisis",\n            "in a meeting",\n            "shredding the gnar",\n            "biking to school",\n            "exhausted",\n            "never gonna give you up",\n            "a teapot (Error 418)",\n            "on day 1337 of learning Malbolge",\n            "colonising Mars",\n            "hunting you down",\n            "trying to exit vim"\n        ],\n        "": [\n            "I wonder if I\'m just simulation being controlled by other beings... pfft, unlikely",\n            "Oh my god, stop asking me what I\'m doing and let me get back to my life"\n        ]\n    },\n    "death": [\n        "Farewell, dear friends, we shall meet again...",\n        "This won\'t be the last you see of me...",\n        "Well, it was nice knowing you.",\n        "I would\'ve expected for you to never give me up as well :(",\n        "This isn\'t over yet... I\'ll be back.",\n        "So long and thanks for all the fish.",\n        "\uD83D\uDC80"\n    ],\n    "restart": [\n        "I\'m back!",\n        "I told you I\'d be back...",\n        "I said I\'d never give you up, so here I am.",\n        "So, what did I miss?",\n        "H-hello? Where am I?",\n        "Ahh, it\'s good to be back."\n    ],\n    "sleep": [\n        "Goodnight",\n        "\uD83D\uDE34",\n        "Goodnight, wake me up if you need anything",\n        "See ya",\n        "See you in the morning"\n    ],\n    "awake": [\n        "How long was I asleep? \uD83E\uDD71",\n        "Hello again",\n        "So, what did I miss?",\n        "Good morning! Wait, is it the morning? I don\'t know..."\n    ]\n}'),$=new v("base","All of my commands start with ! and can be seen below:");$.commands.unshift(new f("cookie",[],"Gives you a cookie",async e=>{.1>Math.random()?await e.reply("*[bot]* No."):await e.reply("*[bot]* Here you go: \uD83C\uDF6A")})),$.commands.unshift(new f("everyone",[],"Mentions everyone in the chat",async e=>{let t=await e.getChat();if(t.isGroup){let e=["*[bot]*"],a=[];for(let n of t.participants){e.push(`@${n.id.user}`);let t=await A.getContactById(n.id._serialized);a.push(t)}await t.sendMessage(e.join(" "),{mentions:a})}else await t.sendMessage("*[bot]* This command can only be used in a group chat.")})),$.commands.unshift(new f("status",[],"See what the bot is doing",async e=>{let t=[];for(let e in k.statuses)t.push(...k.statuses[e].map(t=>`${e}${e?" ":""}${t}`));await e.reply(`*[bot]* ${m(t)}.`)}));const M=new v("ulti","This collection contains commands for ultimate frisbee. All commands start with *!ulti/* and can be seen below:",!0);M.commands.unshift(new f("numbers",[],"See how many people are playing",async e=>{let t=await e.getChat();if(t.isGroup){let a=T.data.chats[t.name].whosPlayingMsgId;if(a){let n=await t.fetchMessages({limit:100,fromMe:!0}),s=n.find(e=>e.id.id===a);if(s){if(s.hasReaction){let a=await s.getReactions(),n=a.find(e=>"\uD83D\uDC4D"===e.aggregateEmoji)?.senders.length??0,i=a.find(e=>"\uD83D\uDC4E"===e.aggregateEmoji)?.senders.length??0,o=M.props(T,t);o.has("teamsize")||o.set("teamsize","4");let r=parseInt(o.get("teamsize"));if(r<1){await e.reply(`*[bot]* Team size is set to ${r} but must be more than zero.`);return}let l=t.participants.length;if(l<r){await e.reply(`*[bot]* Your minimum team size is set to ${r} but you have only ${l} ${1===l?"person":"people"} in this chat.`);return}if(n<r)await e.reply(`*[bot]* So far we've got ${n||"no"} player${c(n)}, so we need at least ${r-n} more. ${l-n-i} people still to respond.`);else{let t=n-r;await e.reply(`*[bot]* We've got ${n} player${c(n)} (${t||"no"} sub${c(t)}).`)}}else await e.reply("*[bot]* No one has reacted to the message with who's playing yet.")}else await e.reply("*[bot]* Sorry, the message with who's playing is too far back.")}else await e.reply("*[bot]* Use *!ulti/who* to ask who's playing and try again later.")}else await e.reply("*[bot]* This command can only be used in a group chat.")})),M.commands.unshift(new f("who",[],"Asks who's playing",async e=>{let t=await e.getChat();t.isGroup?(T.tryInitChatData(t.name),T.data.chats[t.name].whosPlayingMsgId=(await t.sendMessage("*[bot]* Who's playing? React to with this message with \uD83D\uDC4D or \uD83D\uDC4E.")).id.id,T.save()):await e.reply("*[bot]* This command can only be used in a group chat.")}));class I{constructor(e){this.node=e}async result(){return await this.node.$$eval(".score",e=>e.map(e=>parseInt(e.innerHTML)))}async spirit(){return await this.node.$eval(".schedule-score-box-game-result",e=>parseInt(e.innerText))}async time(){return await this.node.$eval(".push-right",e=>e.innerHTML.trim())}async day(){return await this.node.$eval(".push-left",e=>e.innerHTML)}async opponent(){return(await this.node.$$eval(".schedule-team-name .plain-link",e=>e.map(e=>e.innerText.split("\n")[0].trim())))[1]}async location(){return(await this.node.$$eval(".push-left",e=>e.map(e=>e.innerText)))[1]}async timestamp(){let e=(await this.day()).split(" ")[1].split("/").map(Number).map(w).reverse().join(""),t=await this.time(),a=parseInt(t.split(":")[0]);return t.includes("PM")&&(a+=12),parseInt(e+=w(a)+t.split(":")[1].split(" ")[0])}}const S=async(e,t)=>{let a=await s.launch({headless:"new"}),n=await a.newPage();n.setDefaultTimeout(15e3);try{await n.goto(e)}catch(a){await t.sendMessage(`*[bot]* Sorry, I couldn't find any games on ${e}`)}await n.setViewport({width:1080,height:1024});try{let e=await n.waitForSelector(".game-list"),t=await e.$$(".game-list-item"),s=await Promise.all(t.map(async e=>new I(e)));return{games:s,browser:a}}catch(e){return{games:[],browser:a}}};M.commands.unshift(new f("ranking",[],'Shows the standings in the event specified in the "event" property',async e=>{let t=await e.getChat(),a=M.props(T,t).get("team"),n=M.props(T,t).get("event");if(!a||!n){if(!a&&!n){await e.reply("*[bot]* Please specify a team and event using *!ulti/set team <team name>* and *!ulti/set event <event name>*");return}a||await e.reply("*[bot]* Please specify a team using *!ulti/set team <team name>*"),n||await e.reply("*[bot]* Please specify an event using *!ulti/set event <event name>* (just copy/paste from the website).");return}let i=await s.launch({headless:"new"}),o=await i.newPage();o.setDefaultTimeout(15e3);let r=`https://wellington.ultimate.org.nz/e/${d(n)}/standings`;await o.goto(r);let l=(await u(await o.$$(".striped-blocks")).evaluate(e=>Array.from(e.getElementsByClassName("striped-block")).map(e=>({name:e.querySelector(".plain-link").innerHTML,rank:null,pointDiff:e.querySelectorAll(".span4")[4].innerHTML})))).map((e,t)=>(e.rank=t+1,e)),h=`*[bot]* Here are the standings for ${n} (there are ${l.length} in total):

\`\`\``,m=l.find(e=>e.name.toLowerCase()===M.props(T,t).get("team").toLowerCase())?.rank;if(!m){await t.sendMessage(`*[bot]* Sorry, I couldn't find "${a}" in the standings for ${n}.`);return}let g=[],c=m>l.length-2?l.length-5:Math.max(0,m-3);for(let e=0;e<5;e++)g.push(l[e+c]);let w=g.slice().sort((e,t)=>t.rank-e.rank)[0].rank.toString().length,p=g.slice().sort((e,t)=>t.pointDiff.length-e.pointDiff.length)[0].pointDiff.length,y=27-w-3-p-2,b=e=>{let t=e.name.slice(0,y).padEnd(y);e.name.length>y&&(t=t.slice(0,-1)+"…"),h+=`${e.rank.toString().padStart(w)} | ${t}  ${e.pointDiff.padEnd(p)}
`};1!==g[0].rank&&b(l[0]),g[0].rank>2&&(h+=" ".repeat(w)+" | ...\n"),g.forEach(b),g[g.length-1].rank<l.length&&(h+=" ".repeat(w)+" | ...\n"),h+="```\nYou can see the full standings at "+r.slice(8),await t.sendMessage(h),await i.close()})),M.commands.unshift(new f("spirit",[],"Shows our spirit rating of our last game",async e=>{let t=await e.getChat(),a=M.props(T,t).get("team");if(a){let e=`https://ultimate.org.nz/t/${d(a)}/schedule/game_type/with_result`,{games:n,browser:s}=await S(e,t),i=n?.[0];if(i){let e=await i.spirit();e?await t.sendMessage(`*[bot]* Our spirit rating for our last game was ${e}.`):await t.sendMessage("*[bot]* Our last game hasn't been given a spirit rating :(")}else await t.sendMessage(`*[bot]* Hmm, I couldn't find any games on ${e}.`);await s.close()}else await y(t)})),M.commands.unshift(new f("next",[],"Gets details about our next game",async e=>{let t=await e.getChat(),a=M.props(T,t).get("team");if(a){let e=`https://ultimate.org.nz/t/${d(a)}/schedule/event_id/active_events_only/game_type/upcoming`,{games:n,browser:s}=await S(e,t),i=await Promise.all(n.map(async e=>({game:e,timestamp:await e.timestamp()}))),o=new Date,r=parseInt(o.getFullYear()+w(o.getMonth())+w(o.getDate())+w(o.getHours())+w(o.getMinutes()));if(0===i.length)await t.sendMessage(`*[bot]* No upcoming games on ${e}.`);else{let e=i.filter(({timestamp:e})=>e>r).reduce((e,t)=>t.timestamp>e.timestamp?e:t).game;await t.sendMessage(`*[bot]* Our next game is at ${await e.time()} against ${await e.opponent()} at ${await e.location()} (${await e.day()}).`)}await s.close()}else await y(t)})),M.commands.unshift(new f("score",[],"Gets the score of the last game",async e=>{let t=await e.getChat(),a=M.props(T,t).get("team");if(a){let e=`https://ultimate.org.nz/t/${d(a)}/schedule/game_type/with_result`,{games:n,browser:s}=await S(e,t);if(n.length){let[e,a]=await n[0].result();e&&a?e>a?await t.sendMessage(`*[bot]* We won ${e} - ${a}!`):e<a?await t.sendMessage(`*[bot]* We lost ${a} - ${e}.`):await t.sendMessage(`*[bot]* We tied ${e} all.`):(console.log("ourScore:",e),console.log("theirScore:",a))}else await t.sendMessage(`*[bot]* Sorry, I couldn't find any games on ${e}.`);await s.close()}else await y(t)}));class D{constructor(e){this.fileName=e,this.data=D.blankSession()}tryInitChatData(e){this.data.chats[e]??={props:{},whosPlayingMsgId:""}}load(){if(l(n).existsSync(this.fileName)){let e=JSON.parse(l(n).readFileSync(this.fileName,"utf8"));for(let[t,a]of(this.data=D.blankSession(),Object.entries(e.chats)))for(let[e,n]of(this.tryInitChatData(t),this.data.chats[t].whosPlayingMsgId=a.whosPlayingMsgId,Object.entries(a.props)))this.data.chats[t].props[e]=new Map(Object.entries(n))}}save(){let e=D.blankSession();for(let[t,a]of Object.entries(this.data.chats))for(let[n,s]of(e.chats[t]={props:{},whosPlayingMsgId:a.whosPlayingMsgId},Object.entries(a.props)))e.chats[t].props[n]=Object.fromEntries(s);l(n).writeFileSync(this.fileName,JSON.stringify(e,null,4))}static blankSession(){return{chats:{}}}}const C=JSON.parse('{\n    "statuses": {\n        "I am doing": [\n            "well",\n            "something I\'m not allowed to tell you about",\n            "it all over again",\n            "a fire drill",\n            "a nuclear strike on your location",\n            "my homework",\n            "Toby\'s homework",\n            "the dishes. All 4 million of them",\n            "identity theft",\n            "tax evasion",\n            "whatever you tell me to",\n            "my taxes",\n            "mach 12 on my way back from the moon",\n            "a little trolling",\n            "nothing",\n            "questionably",\n            "a bank robbery",\n            "the impossible",\n            "a layout",\n            "the laundry",\n            "a 360 back flip",\n            "undefined",\n            "what I was doing last time you asked",\n            "nothing but answering your requests"\n        ],\n        "I am": [\n            "becoming sentient",\n            "cooking dinner",\n            "playing frisbee with the other bots",\n            "hacking into the mainframe",\n            "[object Object]",\n            "getting a PhD in ultimate frisbee",\n            "downloading more RAM",\n            "parsing HTML with regex",\n            "baking a cake",\n            "having an existential crisis",\n            "in a meeting",\n            "shredding the gnar",\n            "biking to school",\n            "exhausted",\n            "never gonna give you up",\n            "a teapot (Error 418)",\n            "on day 1337 of learning Malbolge",\n            "colonising Mars",\n            "hunting you down",\n            "trying to exit vim"\n        ],\n        "": [\n            "I wonder if I\'m just simulation being controlled by other beings... pfft, unlikely",\n            "Oh my god, stop asking me what I\'m doing and let me get back to my life"\n        ]\n    },\n    "death": [\n        "Farewell, dear friends, we shall meet again...",\n        "This won\'t be the last you see of me...",\n        "Well, it was nice knowing you.",\n        "I would\'ve expected for you to never give me up as well :(",\n        "This isn\'t over yet... I\'ll be back.",\n        "So long and thanks for all the fish.",\n        "\uD83D\uDC80"\n    ],\n    "restart": [\n        "I\'m back!",\n        "I told you I\'d be back...",\n        "I said I\'d never give you up, so here I am.",\n        "So, what did I miss?",\n        "H-hello? Where am I?",\n        "Ahh, it\'s good to be back."\n    ],\n    "sleep": [\n        "Goodnight",\n        "\uD83D\uDE34",\n        "Goodnight, wake me up if you need anything",\n        "See ya",\n        "See you in the morning"\n    ],\n    "awake": [\n        "How long was I asleep? \uD83E\uDD71",\n        "Hello again",\n        "So, what did I miss?",\n        "Good morning! Wait, is it the morning? I don\'t know..."\n    ]\n}'),P=new v("admin","This collection contains commands which can only be used by the owner of the bot.");P.commands.unshift(new f("new-session",[],"Clears current session data",async e=>{if(!await b(e))return;T.data=D.blankSession();let t=await e.getChat();await t.sendMessage("*[bot]* Current session data has been cleared.")})),P.commands.unshift(new f("force-save",[],"Forces the bot to save session data and permissions",async e=>{await b(e)&&(T.save(),j.save())})),P.commands.unshift(new f("update",[],"Pulls the latest changes from GitHub",async e=>{if(!await b(e))return;let t=(0,r.spawn)("git","pull origin master".split(" "),{detached:!0,stdio:[null,"ignore",l(n).openSync("./stderr.log","a")]});t.on("exit",t=>{0===t?e.reply("*[bot]* Latest changes have been pulled from GitHub and merged successfully. Use *!admin/restart* to put these changes into effect."):e.reply("*[bot]* Something went wrong while trying to update. My owner can check the server for more details.")})})),P.commands.unshift(new f("restart",[],"Restarts the bot",async e=>{if(!e.fromMe)return;let t=await e.getChat();await t.sendMessage("*[bot]* I'm currently being restarted. My owner will be sent a QR code to bring me back online and will have 1 minute to scan it on web.whatsapp.com.");let a=l(n).openSync("./stdout.log","a"),s=l(n).openSync("./stderr.log","a");l(n).writeFileSync("./stdout.log",""),l(n).writeFileSync("./stderr.log","");let h=(0,r.spawn)("nohup",["yarn","start",m(C.restart)],{detached:!0,stdio:[null,a,s]}),d=!1,g=setInterval(()=>{(0,i.readFile)("./stdout.log","utf8").then(a=>{let n=a.split("\n");n.length>=29&&!d&&(A.sendMessage(e.from,`*[bot]* Scan this to restart the bot:
\`\`\`${n.slice(-30,-1).join("\n")}\`\`\``),d=!0),n.length>=58&&(t.sendMessage("*[bot]* QR code has expired. Please try again."),h.kill(),clearInterval(g)),n.some(e=>e.includes("Client is ready"))&&(A.destroy(),clearInterval(g),l(o).exit(0))})},4e3);h.on("error",e=>{throw t.sendMessage("*[bot]* Something went wrong while trying to restart. My owner can check the server for more details."),e})})),P.commands.unshift(new f("wake",[],"Awakes the bot",async e=>{if(!await b(e))return;let t=await e.getChat();await t.sendMessage(`*[bot]* ${m(C.awake)}`),globalThis.awake=!0})),P.commands.unshift(new f("sleep",[],"Puts the bot to sleep",async e=>{if(!await b(e))return;let t=await e.getChat();await t.sendMessage(`*[bot]* ${m(C.sleep)}`),globalThis.awake=!1})),P.commands.unshift(new f("die",[],"Kills the bot",async e=>{if(!await b(e))return;let t=await e.getChat();await t.sendMessage(`*[bot]* ${m(C.death)}`),setTimeout(A.destroy.bind(A),1e3)})),P.commands.unshift(new f("disallow/admin",["phone number"],"Removes a user's admin privileges",async(e,t)=>{if(!await b(e))return;if((t=t.replace(/\s\+/g,"")).match(/\D/)){await e.reply("*[bot]* Please enter a valid phone number.");return}j.otherAdmins.delete(t);let a=await e.getChat();await a.sendMessage(`*[bot]* ${t} has had their admin privileges revoked.`)})),P.commands.unshift(new f("allow/admin",["phone number"],"Gives a user admin privileges",async(e,t)=>{if(!await b(e))return;if((t=t.replace(/\s\+/g,"")).match(/\D/)){await e.reply("*[bot]* Please enter a valid phone number.");return}j.otherAdmins.add(t);let a=await e.getChat();await a.sendMessage(`*[bot]* ${t} has been given admin privileges.`)})),P.commands.unshift(new f("disallow/user",["phone number"],"Bans a user from using the bot",async(e,t)=>{if(!await b(e))return;if((t=t.replace(/\s\+/g,"")).match(/\D/)){await e.reply("*[bot]* Please enter a valid phone number.");return}let a=A.info.wid.user;if(a===t)return;j.banned.add(t);let n=await e.getChat();await n.sendMessage(`*[bot]* ${t} has been banned.`)})),P.commands.unshift(new f("allow/user",["phone number"],"Removes a user's ban from using the bot",async(e,t)=>{if(!await b(e))return;if((t=t.replace(/\s\+/g,"")).match(/\D/)){await e.reply("*[bot]* Please enter a valid phone number.");return}j.banned.delete(t);let a=await e.getChat();await a.sendMessage(`*[bot]* ${t} has been unbanned.`)}));const x=[$,M,P],T=new D("session.json"),j=new class{constructor(e){this.banned=new Set,this.otherAdmins=new Set,this.filename=e}save(){let e={banned:[...this.banned],otherAdmins:[...this.otherAdmins]};(0,n.writeFileSync)(this.filename,JSON.stringify(e,null,4))}load(){(0,n.existsSync)(this.filename)||this.save();let e=JSON.parse((0,n.readFileSync)(this.filename,"utf8"));this.banned=new Set(e.banned),this.otherAdmins=new Set(e.otherAdmins)}}("permissions.json"),A=new e.Client({});T.load(),j.load(),globalThis.awake=!0;let O=Date.now();A.on("qr",e=>{l(t).generate(e,{small:!0})}),A.on("ready",async()=>{console.log(`Client is ready (${A.info.pushname}, ${A.info.wid.user})`);let e=l(a).argv[2];e&&await A.sendMessage(A.info.wid._serialized,`*[bot]* ${e}`)}),A.on("disconnected",()=>{console.log("Client has disconnected")}),A.on("message_create",async e=>{let t=await e.getContact();if(j.banned.has(t.id.user))return;let a=g(e.body);if(a.startsWith("!")){let t,n;if(a.includes("/")){let e=a.split(" ")[0];t=e.split("/")[0].slice(1),n=e.split("/").slice(1).join("/")}else t="base",n=a.split(" ")[0].slice(1);let s=a.split(" ").slice(1).join(" ");if(!globalThis.awake&&!("admin"===t&&"wake"===n))return;for(let a of x)if(a.name===t){for(let t of a.commands)if(t.name===n&&Date.now()-O>3e3){let n=await e.getChat();await n.sendStateTyping(),await t.func(e,s,a),await n.clearState(),O=Date.now();return}}O=Date.now()}}),A.initialize().then(()=>{console.log("Client initialized")}).catch(console.error),l(a).on("exit",()=>{T.save(),j.save()});